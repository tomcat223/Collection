<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>DAY06</title>
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>

  <style>
    body { font-family: sans-serif; padding: 20px; background-color: #f4f4f4; }
    input, button { padding: 10px; margin: 10px 0; width: 300px; }
    #output { margin-top: 20px; font-size: 18px; }
  </style>
  
</head>
<body>
  <button id="connectButton" onclick="connectWallet()">ğŸ”— è¿æ¥é’±åŒ…</button>
  <input type="text" id="Input" placeholder="è¯·è¾“å…¥å†…å®¹">
  <button onclick="submitLog()">ä¿å­˜</button>
  
  <div id="output"></div>
  <button onclick="loadLogs()">ğŸ“œ æŸ¥çœ‹æ‰€æœ‰æ—¥å¿—</button>
  <div id="logList"></div>
  
  <script>
const contractAddress = "0xe6b3f32c2e364b07e51beedf44629688572d27ba";
const abi = [
  {
    "inputs": [
      { "internalType": "string", "name": "_date", "type": "string" },
      { "internalType": "string", "name": "_content", "type": "string" }
    ],
    "name": "addLog",
    "outputs": [],
    "stateMutability": "nonpayable",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "_index", "type": "uint256" }
    ],
    "name": "getLog",
    "outputs": [
      { "internalType": "string", "name": "", "type": "string" },
      { "internalType": "string", "name": "", "type": "string" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [],
    "name": "getLogCount",
    "outputs": [
      { "internalType": "uint256", "name": "", "type": "uint256" }
    ],
    "stateMutability": "view",
    "type": "function"
  },
  {
    "inputs": [
      { "internalType": "uint256", "name": "", "type": "uint256" }
    ],
    "name": "logs",
    "outputs": [
      { "internalType": "string", "name": "date", "type": "string" },
      { "internalType": "string", "name": "content", "type": "string" }
    ],
    "stateMutability": "view",
    "type": "function"
  }
];


let contract;

async function connectWallet() {
  if (!window.ethereum) {
    alert("è¯·å®‰è£… MetaMask");
    return;
  }

  await window.ethereum.request({ method: 'eth_requestAccounts' });
  const provider = new ethers.providers.Web3Provider(window.ethereum);
  const signer = provider.getSigner();
  contract = new ethers.Contract(contractAddress, abi, signer);

  alert("é’±åŒ…å·²è¿æ¥");
}

async function submitLog() {
  const date = "2025-04-21"; // ä½ å¯ä»¥ç”¨ JS è‡ªåŠ¨è·å–ä»Šå¤©æ—¥æœŸ
  const content = document.getElementById("Input").value;
  const tx = await contract.addLog(date, content);
  await tx.wait();
  alert("æ—¥å¿—å·²ä¸Šä¼ ï¼");
}
async function submitLog() {
  try {
    const date = "2025-04-21"; // å¯ä»¥æ”¹æˆåŠ¨æ€è·å–æ—¥æœŸ
    const content = document.getElementById("Input").value;
    const tx = await contract.addLog(date, content);
    await tx.wait();
    alert("æ—¥å¿—å·²ä¸Šä¼ ï¼");
  } catch (error) {
    console.error(error);
    alert("ä¸Šä¼ å¤±è´¥ï¼š" + (error.message || "è¯·æŸ¥çœ‹æ§åˆ¶å°"));
  }
}
async function loadLogs() {
  try {
    const count = await contract.getLogCount();
    const logList = document.getElementById("logList");
    logList.innerHTML = ""; // æ¸…ç©ºä¹‹å‰çš„å†…å®¹

    for (let i = 0; i < count; i++) {
      const log = await contract.getLog(i);
      const date = log[0];
      const content = log[1];

      const div = document.createElement("div");
      div.style.background = "#fff";
      div.style.margin = "10px 0";
      div.style.padding = "10px";
      div.style.borderRadius = "8px";
      div.innerHTML = `<strong>${date}</strong><br>${content}`;
      logList.appendChild(div);
    }
  } catch (error) {
    console.error(error);
    alert("åŠ è½½æ—¥å¿—å¤±è´¥ï¼š" + (error.message || "è¯·æŸ¥çœ‹æ§åˆ¶å°"));
  }
}


  </script>
</body>
</html>
